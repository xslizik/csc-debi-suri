---
- name: Download suricata setup.sh
  get_url:
    url: https://raw.githubusercontent.com/xslizik/csc-debi-suri/main/wget/setup.sh
    dest: /tmp
    validate_certs: no

- name: Run suricata setup.sh
  shell: "chmod +x /tmp/setup.sh && /tmp/setup.sh"

- name: Remove suricata setup.sh
  file:
    path: /tmp/setup.sh
    state: absent

- name: Update Suricata rules
  shell: suricata-update update-sources
  register: update_result

- name: Enable the et/open source
  shell: suricata-update enable-source et/open
  register: enable_result

- name: Download suricata.yaml
  get_url:
    url: https://raw.githubusercontent.com/xslizik/csc-debi-suri/main/wget/suricata.yaml
    dest: /usr/local/var/lib/suricata/suricata.yaml
    validate_certs: no

- name: Download classification.config
  get_url:
    url: https://raw.githubusercontent.com/xslizik/csc-debi-suri/main/wget/classification.config
    dest: /usr/local/var/lib/suricata/classification.config
    validate_certs: no

- name: Download reference.config
  get_url:
    url: https://raw.githubusercontent.com/xslizik/csc-debi-suri/main/wget/reference.config
    dest: /usr/local/var/lib/suricata/reference.config
    validate_certs: no

- name: Run suricata-update to apply changes
  shell: suricata-update --suricata-conf /usr/local/var/lib/suricata/suricata.yaml

- name: Clean up
  file:
    path: /home/vagrant/suricata-7.0.1
    state: absent