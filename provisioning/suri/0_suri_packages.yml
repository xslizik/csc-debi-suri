- name: Update packages
  apt:
    update_cache: yes

- name: Install required packages
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - software-properties-common
    - jq
    - wget
    - gnupg
    - apt-transport-https
    - unzip
    - libpcre2-dev
    - libyaml-dev
    - libjansson-dev
    - libpcap-dev
    - gawk
    - libunwind-dev
    - libmagic-dev
    - liblz4-dev
    - libcap-ng-dev
    - python-pip
    - libnetfilter-queue-dev
    - libnetfilter-queue1
    - libnfnetlink-dev
    - libnfnetlink0
    - vim

- name: Install dpkt using pip
  pip:
    name: dpkt
    state: present

- name: Download Suricata source
  get_url:
    url: https://www.openinfosecfoundation.org/download/suricata-7.0.1.tar.gz
    dest: /opt/suricata-7.0.1.tar.gz

- name: Extract Suricata source
  unarchive:
    src: /opt/suricata-7.0.1.tar.gz
    dest: /opt
    remote_src: yes

- name: Remove Suricata source
  file:
    path: /opt/suricata-7.0.1.tar.gz
    state: absent